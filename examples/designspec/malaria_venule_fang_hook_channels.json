{
  "schema": {
    "name": "aog_designspec",
    "version": "1.0.0",
    "compatible_with": ["1.0.x"]
  },
  "meta": {
    "name": "malaria_venule_fang_hook_channels_v2",
    "description": "5mm radius x 2mm height cylinder with real top ridge; 9 fang-hook channels with radial-out bend; all inputs in meters.",
    "seed": 42,
    "input_units": "m",
    "tags": ["malaria", "venule", "fang_hook", "channels", "ridge", "meters"]
  },
  "policies": {
    "resolution": {
      "input_units": "m",
      "min_channel_diameter": 0.001,
      "min_voxels_across_feature": 24,
      "max_voxels": 50000000,
      "min_pitch": 1e-6,
      "max_pitch": 5e-4,
      "auto_relax_pitch": true,
      "pitch_step_factor": 1.5,
      "rel_epsilon": 1e-6,
      "embed_pitch_factor": 1.0,
      "merge_pitch_factor": 1.0,
      "repair_pitch_factor": 1.0
    },

    "domain_meshing": {
      "cache_meshes": true,
      "emit_warnings": true,
      "target_face_count": 120000,
      "voxel_pitch": null,
      "primitive_policy": {
        "sections_radial": 128,
        "sections_axial": 64,
        "sections_angular": 128,
        "subdivisions": 2
      },
      "mesh_policy": {
        "validate_watertight": true,
        "repair_if_needed": true,
        "repair_voxel_pitch": 5e-5,
        "max_faces": 800000,
        "simplify_if_over_max": true,
        "simplify_target_ratio": 0.6
      },
      "implicit_policy": {
        "voxel_pitch": 5e-5,
        "max_voxels": 20000000,
        "auto_relax_pitch": true,
        "pitch_step_factor": 1.5,
        "iso_level": 0.0,
        "smooth_iterations": 2
      }
    },

    "ridge": {
      "enabled": true,
      "face": "top",
      "height": 0.0005,
      "thickness": 0.0005,
      "inset": 0.0,
      "overlap": 0.00025,
      "resolution": 128
    },

    "channels": {
      "enabled": true,
      "profile": "fang_hook",
      "length_mode": "to_depth",
      "length": null,
      "length_fraction": 1.0,
      "start_offset": 0.0,
      "stop_before_boundary": 0.001,

      "taper_factor": 0.2,
      "radius_end": null,

      "bend_mode": "radial_out",
      "hook_depth": 0.0005,
      "hook_strength": 0.6,
      "hook_angle_deg": 90.0,

      "straight_fraction": 0.6,
      "curve_fraction": 0.4,
      "bend_shape": "quadratic",

      "segments_per_curve": 24,
      "radial_sections": 32,
      "path_samples": 48,

      "enforce_effective_radius": true,
      "constraint_strategy": "reduce_depth"
    },

    "composition": {
      "repair_enabled": false,
      "union_before_embed": true,
      "keep_largest_component": false,

      "synthesis_policy": {
        "add_node_spheres": false,
        "cap_ends": true,
        "voxel_repair_synthesis": false,
        "voxel_repair_pitch": 3e-5,
        "voxel_repair_auto_adjust": true,
        "voxel_repair_max_steps": 4,
        "voxel_repair_step_factor": 1.5,
        "voxel_repair_max_voxels": 8000000,
        "segments_per_circle": 24,
        "mutate_network_in_place": false,
        "use_resolution_policy": true
      },

      "merge_policy": {
        "mode": "auto",
        "voxel_pitch": null,
        "auto_adjust_pitch": true,
        "max_pitch_steps": 4,
        "pitch_step_factor": 1.5,
        "fallback_boolean": true,
        "keep_largest_component": false,
        "min_component_faces": 100,
        "min_component_volume": 1e-10,
        "fill_voxels": false,
        "max_voxels": 8000000,
        "use_resolution_policy": true,
        "min_voxels_per_diameter": 6,
        "min_channel_diameter": 0.001,
        "detail_loss_threshold": 0.5,
        "detail_loss_strictness": "warn"
      },

      "repair_policy": {
        "voxel_repair_enabled": false,
        "fill_voxels": false
      }
    },

    "embedding": {
      "voxel_pitch": null,
      "shell_thickness": 0.0,
      "use_resolution_policy": true,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 4,
      "pitch_step_factor": 1.5,
      "max_voxels": 8000000,
      "fallback": "auto",

      "preserve_ports_enabled": true,
      "preserve_mode": "recarve",
      "carve_radius_factor": 1.2,
      "carve_depth": 0.0005
    },

    "validity": {
      "check_watertight": true,
      "check_components": false,
      "check_min_diameter": false,
      "check_open_ports": false,
      "check_bounds": true,
      "check_void_inside_domain": true,
      "allow_boundary_intersections_at_ports": false
    },

    "open_port": {
      "enabled": false
    },

    "repair": {
      "voxel_repair_enabled": false,
      "fill_voxels": false
    },

    "output": {
      "output_dir": "./out/malaria_venule_fang_hook_channels_v2",
      "output_units": "m",
      "naming_convention": "default",
      "save_intermediates": true,
      "save_reports": true,
      "output_stl": true,
      "output_json": true,
      "output_shell": false
    }
  },

  "domains": {
    "cylinder_domain": {
      "type": "cylinder",
      "center": [0.0, 0.0, 0.0],
      "radius": 0.005,
      "height": 0.002
    }
  },

  "components": [
    {
      "id": "fang_hook_channels_9x",
      "domain_ref": "cylinder_domain",
      "ports": {
        "inlets": [
          { "name": "inlet_center", "position": [0.0, 0.0, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },

          { "name": "inlet_r1_e", "position": [0.0015, 0.0, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },
          { "name": "inlet_r1_w", "position": [-0.0015, 0.0, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },
          { "name": "inlet_r1_n", "position": [0.0, 0.0015, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },
          { "name": "inlet_r1_s", "position": [0.0, -0.0015, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },

          { "name": "inlet_r2_ne", "position": [0.00212132034356, 0.00212132034356, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },
          { "name": "inlet_r2_nw", "position": [-0.00212132034356, 0.00212132034356, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },
          { "name": "inlet_r2_sw", "position": [-0.00212132034356, -0.00212132034356, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 },
          { "name": "inlet_r2_se", "position": [0.00212132034356, -0.00212132034356, 0.001], "direction": [0.0, 0.0, -1.0], "radius": 0.0005 }
        ],
        "outlets": []
      },
      "build": {
        "type": "primitive_channels"
      },
      "save_artifacts": {
        "void_mesh": "artifacts/fang_hook_channels_9x_void.stl"
      }
    }
  ],

  "composition": {
    "save_union": "artifacts/union_void.stl"
  },

  "embedding": {
    "enable": true,
    "outputs": {
      "domain_with_void": "domain_with_void.stl",
      "void_mesh": "void_union.stl"
    }
  },

  "validity": {
    "enable": false,
    "save_report": "validity_report.json"
  },

  "outputs": {
    "artifacts_dir": "artifacts",
    "named": {
      "run_report": "run_report.json"
    }
  }
}
