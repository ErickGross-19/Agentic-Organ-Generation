{
  "schema": {
    "name": "aog_designspec",
    "version": "1.0.0",
    "compatible_with": [
      "1.0.x"
    ]
  },
  "meta": {
    "name": "malaria_venule_space_colonization_overhaul",
    "description": "Dense multi-inlet space colonization (target 1024 terminals) inside a 5mm radius x 2mm height cylinder with ridge. Inputs in meters.",
    "seed": 42,
    "input_units": "m",
    "tags": [
      "malaria",
      "venule",
      "space_colonization",
      "dense",
      "merge",
      "meters"
    ]
  },
  "policies": {
    "resolution": {
      "input_units": "m",
      "min_channel_diameter": 2e-05,
      "min_voxels_across_feature": 12,
      "max_voxels": 80000000,
      "min_pitch": 1e-06,
      "max_pitch": 2e-05,
      "auto_relax_pitch": false,
      "pitch_step_factor": 1.5,
      "max_voxels_embed": 14000000,
      "max_voxels_merge": 14000000,
      "max_voxels_repair": 14000000
    },
    "domain_meshing": {
      "cache_meshes": true,
      "emit_warnings": true,
      "target_face_count": 140000,
      "voxel_pitch": null,
      "primitive_policy": {
        "sections_radial": 160,
        "sections_axial": 80,
        "sections_angular": 160,
        "subdivisions": 2
      },
      "mesh_policy": {
        "validate_watertight": true,
        "repair_if_needed": true,
        "repair_voxel_pitch": 5e-05,
        "max_faces": 900000,
        "simplify_if_over_max": true,
        "simplify_target_ratio": 0.6
      }
    },
    "ridge": {
      "enabled": true,
      "face": "top",
      "height": 0.0005,
      "thickness": 0.0005,
      "inset": 0.0,
      "overlap": 0.00025,
      "resolution": 160
    },
    "network_cleanup": {
      "enable_snap": false,
      "snap_tol": 2e-05,
      "enable_prune": false,
      "min_segment_length": 0.0001,
      "enable_merge": false,
      "merge_tol": 2e-05
    },
    "growth": {
      "enabled": true,
      "backend": "space_colonization",
      "target_terminals": 384,
      "terminal_tolerance": 0.2,
      "max_iterations": 100,
      "step_size": 0.0001,
      "min_segment_length": 0.0001,
      "max_segment_length": 0.00025,
      "min_radius": 3e-05,
      "max_radius": 0.0002,
      "backend_params": {
        "num_attraction_points": 250000,
        "influence_radius": 0.00045,
        "kill_radius": 0.00018,
        "branch_enable_after_distance": 0.0002,
        "min_branch_segment_length": 0.0001,
        "directional_bias": 0.0,
        "primary_axis": [
          0,
          0,
          -1
        ],
        "max_deviation_deg": 180.0,
        "upward_forbidden": false,
        "multi_inlet_mode": "blended",
        "collision_merge_distance": 0.0004,
        "encourage_bifurcation": true,
        "max_children_per_node": 3,
        "bifurcation_probability": 0.85,
        "min_attractions_for_bifurcation": 6,
        "bifurcation_angle_threshold_deg": 10.0,
        "progress": true,
        "kdtree_rebuild_tip_every": 1,
        "kdtree_rebuild_all_nodes_every": 10,
        "kdtree_rebuild_all_nodes_min_new_nodes": 5,
        "stall_steps_per_inlet": 10,
        "interleaving_strategy": "round_robin",
        "tissue_sampling": {
          "enabled": true,
          "mode": "volume_uniform",
          "depth_min": 0.0001,
          "depth_max": 0.0018,
          "min_distance_to_walls": 0.0002,
          "min_distance_to_ports": 0.0003,
          "ring_r0": 0.0,
          "ring_sigma": 0.0,
          "strategy": "radial_biased",
          "radial_reference": {
            "mode": "face",
            "face": "top",
            "center": "face_center"
          },
          "radial_distribution": "center_heavy",
          "r_min": 0.0,
          "r_max": 0.005,
          "radial_power": 2.2
        },
        "multi_inlet_blend_sigma": 0.0035
      }
    },
    "radius": {
      "mode": "murray",
      "murray_exponent": 3.0,
      "min_radius": 3e-05,
      "max_radius": 0.0002,
      "terminal_radius": 3e-05
    },
    "collision": {
      "enabled": true,
      "check_collisions": true,
      "collision_clearance": 2e-05
    },
    "composition": {
      "repair_enabled": false,
      "union_before_embed": true,
      "keep_largest_component": false,
      "merge_policy": {
        "keep_largest_component": false
      }
    },
    "repair": {
      "voxel_repair_enabled": false,
      "fill_voxels": false
    },
    "embedding": {
      "voxel_pitch": 5e-05,
      "shell_thickness": 0.0,
      "use_resolution_policy": true,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 4,
      "pitch_step_factor": 1.5,
      "max_voxels": 14000000,
      "fallback": "auto",
      "preserve_ports_enabled": true,
      "preserve_mode": "recarve",
      "carve_radius_factor": 1.4,
      "carve_depth": 0.001
    },
    "open_port": {
      "enabled": false
    },
    "validity": {
      "check_watertight": true,
      "check_components": true,
      "check_min_diameter": true,
      "check_open_ports": false,
      "check_bounds": true,
      "check_void_inside_domain": true
    },
    "output": {
      "output_dir": "./out/malaria_venule_space_colonization_overhaul",
      "output_units": "m",
      "save_intermediates": true,
      "save_reports": true,
      "output_stl": true,
      "output_json": true
    }
  },
  "domains": {
    "main_domain": {
      "type": "cylinder",
      "center": [
        0.0,
        0.0,
        0.0
      ],
      "radius": 0.005,
      "height": 0.002
    }
  },
  "components": [
    {
      "id": "space_colonization_5in_dense",
      "domain_ref": "main_domain",
      "ports": {
        "inlets": [
          {
            "name": "inlet_center",
            "position": [
              0.0,
              0.0,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0005
          },
          {
            "name": "inlet_e",
            "position": [
              0.003,
              0.0,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0005
          },
          {
            "name": "inlet_w",
            "position": [
              -0.003,
              0.0,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0005
          },
          {
            "name": "inlet_n",
            "position": [
              0.0,
              0.003,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0005
          },
          {
            "name": "inlet_s",
            "position": [
              0.0,
              -0.003,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0005
          }
        ],
        "outlets": []
      },
      "build": {
        "type": "backend_network"
      },
      "save_artifacts": {
        "network": "artifacts/space_colonization_network.json",
        "void_mesh": "artifacts/space_colonization_void.stl"
      }
    }
  ],
  "embedding": {
    "enable": true,
    "outputs": {
      "domain_with_void": "domain_with_void.stl",
      "void_mesh": "void_union.stl"
    }
  },
  "validity": {
    "enable": false,
    "save_report": "validity_report.json"
  },
  "outputs": {
    "artifacts_dir": "artifacts",
    "named": {
      "domain_mesh": "artifacts/domain_mesh_with_ridge.stl",
      "run_report": "run_report.json"
    }
  }
}
