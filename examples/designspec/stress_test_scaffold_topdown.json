{
  "schema": {
    "name": "aog_designspec",
    "version": "1.0.0",
    "compatible_with": [
      "1.0.x"
    ]
  },
  "meta": {
    "name": "stress_test_scaffold_topdown",
    "description": "Stress test for scaffold top-down backend with higher branching factor and more levels to generate a dense network. Tests collision avoidance performance with many segments.",
    "seed": 999999,
    "input_units": "mm",
    "tags": [
      "scaffold_topdown",
      "stress_test",
      "collision_avoidance",
      "performance"
    ]
  },
  "policies": {
    "resolution": {
      "input_units": "mm",
      "min_channel_diameter": 0.05,
      "min_voxels_across_feature": 4,
      "max_voxels": 5000000,
      "min_pitch": 0.001,
      "max_pitch": 1.0,
      "auto_relax_pitch": true,
      "pitch_step_factor": 1.5
    },
    "domain_meshing": {
      "cache_meshes": true,
      "emit_warnings": true,
      "target_face_count": 30000
    },
    "growth": {
      "enabled": true,
      "backend": "scaffold_topdown",
      "target_terminals": null,
      "terminal_tolerance": 0.1,
      "max_iterations": 500,
      "seed": null,
      "min_segment_length": 0.05,
      "max_segment_length": 3.0,
      "min_radius": 0.03,
      "step_size": 0.2,
      "backend_params": {
        "primary_axis": [0, 0, -1],
        "splits": 4,
        "levels": 6,
        "ratio": 0.75,
        "step_length": 2.5,
        "step_decay": 0.88,
        "spread": 2.0,
        "spread_decay": 0.85,
        "cone_angle_deg": 75,
        "jitter_deg": 15,
        "curvature": 0.4,
        "curve_samples": 9,
        "wall_margin_m": 0.1,
        "min_radius": 0.03,
        "collision_online": {
          "enabled": true,
          "buffer_abs_m": 0.015,
          "buffer_rel": 0.05,
          "cell_size_m": 0.4,
          "rotation_attempts": 18,
          "reduction_factors": [0.7, 0.5, 0.3],
          "max_attempts_per_child": 24,
          "on_fail": "skip_branch"
        },
        "collision_postpass": {
          "enabled": true,
          "min_clearance_m": 0.015,
          "strategy_order": ["shrink", "terminate"],
          "shrink_factor": 0.85,
          "shrink_max_iterations": 8
        }
      }
    },
    "collision": {
      "enabled": true,
      "check_collisions": true,
      "collision_clearance": 0.03
    },
    "unified_collision": {
      "enabled": true,
      "min_clearance": 0.05,
      "strategy_order": [
        "shrink",
        "terminate"
      ],
      "min_radius": 0.02,
      "check_segment_segment": true,
      "check_segment_mesh": false,
      "check_segment_boundary": true,
      "check_node_boundary": true,
      "shrink_factor": 0.85,
      "shrink_max_iterations": 8
    },
    "radius": {
      "mode": "murray",
      "murray_exponent": 3.0,
      "taper_factor": 0.75,
      "min_radius": 0.02,
      "max_radius": 5.0
    },
    "network_cleanup": {
      "enable_snap": true,
      "snap_tol": 0.03,
      "enable_prune": true,
      "min_segment_length": 0.03,
      "enable_merge": true,
      "merge_tol": 0.03
    },
    "mesh_synthesis": {
      "add_node_spheres": true,
      "cap_ends": true,
      "voxel_repair_synthesis": false,
      "segments_per_circle": 12
    },
    "mesh_merge": {
      "mode": "auto",
      "voxel_pitch": 0.03,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 5,
      "pitch_step_factor": 1.5,
      "fallback_boolean": true,
      "keep_largest_component": true,
      "max_voxels": 150000000
    },
    "embedding": {
      "voxel_pitch": null,
      "shell_thickness": 0.3,
      "use_resolution_policy": true,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 5,
      "max_voxels": 3000000,
      "fallback": "auto",
      "preserve_ports_enabled": true,
      "output_domain_with_void": true,
      "output_void_mesh": true
    },
    "validity": {
      "check_watertight": true,
      "check_components": true,
      "check_min_diameter": false,
      "check_open_ports": false,
      "check_bounds": true,
      "check_void_inside_domain": false
    },
    "output": {
      "output_dir": "./out/stress_test_scaffold_topdown",
      "output_units": "mm",
      "naming_convention": "default",
      "save_intermediates": true,
      "save_reports": true,
      "output_stl": true,
      "output_json": true
    }
  },
  "domains": {
    "large_cylinder": {
      "type": "cylinder",
      "center": [0, 0, 0],
      "radius": 10,
      "height": 8
    }
  },
  "components": [
    {
      "id": "stress_test_network",
      "domain_ref": "large_cylinder",
      "ports": {
        "inlets": [
          {
            "name": "inlet_main",
            "position": [0, 0, 4],
            "direction": [0, 0, -1],
            "radius": 1.5,
            "vessel_type": "arterial"
          }
        ],
        "outlets": []
      },
      "build": {
        "type": "backend_network",
        "backend": "scaffold_topdown",
        "backend_params": {
          "primary_axis": [0, 0, -1],
          "splits": 4,
          "levels": 6,
          "ratio": 0.75,
          "step_length": 2.5,
          "step_decay": 0.88,
          "spread": 2.0,
          "spread_decay": 0.85,
          "cone_angle_deg": 75,
          "jitter_deg": 15,
          "curvature": 0.4,
          "curve_samples": 9,
          "wall_margin_m": 0.1,
          "min_radius": 0.03,
          "collision_online": {
            "enabled": true,
            "buffer_abs_m": 0.015,
            "buffer_rel": 0.05,
            "cell_size_m": 0.4,
            "rotation_attempts": 18,
            "reduction_factors": [0.7, 0.5, 0.3],
            "max_attempts_per_child": 24,
            "on_fail": "skip_branch"
          },
          "collision_postpass": {
            "enabled": true,
            "min_clearance_m": 0.015,
            "strategy_order": ["shrink", "terminate"],
            "shrink_factor": 0.85,
            "shrink_max_iterations": 8
          }
        }
      },
      "save_artifacts": {
        "network": "artifacts/stress_test_network.json",
        "void_mesh": "artifacts/stress_test_void.stl"
      }
    }
  ],
  "composition": {
    "save_union": "artifacts/union_void.stl"
  },
  "embedding": {
    "enable": true,
    "outputs": {
      "domain_with_void": "domain_with_void.stl",
      "void_mesh": "void_union.stl"
    }
  },
  "validity": {
    "enable": true,
    "save_report": "validity_report.json"
  },
  "outputs": {
    "artifacts_dir": "artifacts",
    "named": {
      "run_report": "run_report.json"
    }
  }
}
