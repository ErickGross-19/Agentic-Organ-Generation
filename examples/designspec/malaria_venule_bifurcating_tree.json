{
  "schema": {
    "name": "aog_designspec",
    "version": "1.0.0",
    "compatible_with": [
      "1.0.x"
    ]
  },
  "meta": {
    "name": "malaria_venule_bifurcating_tree",
    "description": "Malaria venule insert with K-ary bifurcating tree structure. Uses kary_tree backend to create a bifurcating vascular tree embedded in a cylinder domain.",
    "seed": 42,
    "input_units": "m",
    "tags": [
      "malaria",
      "venule",
      "bifurcating",
      "kary_tree"
    ],
    "original_input_units": "mm"
  },
  "policies": {
    "resolution": {
      "input_units": "m",
      "min_channel_diameter": 0.00002,
      "min_voxels_across_feature": 12,
      "max_voxels": 50000000,
      "min_pitch": 1e-06,
      "max_pitch": 0.001,
      "auto_relax_pitch": true,
      "pitch_step_factor": 1.5,
      "rel_epsilon": 1e-06,
      "embed_pitch_factor": 1.0,
      "merge_pitch_factor": 1.0,
      "repair_pitch_factor": 1.0,
      "pathfinding_coarse_factor": 20.0,
      "pathfinding_fine_factor": 1.0,
      "max_voxels_embed": 20000000,
      "max_voxels_merge": 20000000,
      "max_voxels_repair": 20000000,
      "max_voxels_pathfinding_coarse": 10000000,
      "max_voxels_pathfinding_fine": 10000000,
      "max_voxels_open_port_roi": 10000000
    },
    "domain_meshing": {
      "cache_meshes": true,
      "emit_warnings": true,
      "target_face_count": 50000,
      "min_face_count": null,
      "max_face_count": null,
      "voxel_pitch": null,
      "primitive_policy": {
        "sections_radial": 32,
        "sections_axial": 16,
        "sections_angular": 32,
        "subdivisions": 2
      },
      "mesh_policy": {
        "validate_watertight": true,
        "repair_if_needed": true,
        "repair_voxel_pitch": 5e-06,
        "max_faces": 500000,
        "simplify_if_over_max": true,
        "simplify_target_ratio": 0.5,
        "add_node_spheres": true,
        "cap_ends": true,
        "voxel_repair_synthesis": false,
        "voxel_repair_pitch": 1e-05,
        "segments_per_circle": 16
      },
      "implicit_policy": {
        "voxel_pitch": 5e-06,
        "max_voxels": 100000000,
        "auto_relax_pitch": true,
        "pitch_step_factor": 1.5,
        "iso_level": 0.0,
        "smooth_iterations": 2,
        "mode": "auto",
        "auto_adjust_pitch": true,
        "max_pitch_steps": 4,
        "fallback_boolean": true,
        "keep_largest_component": true,
        "min_component_faces": 100,
        "min_component_volume": 1e-12,
        "fill_voxels": true
      }
    },
    "pathfinding": {
      "use_resolution_policy": true,
      "coarse_pitch_factor": 4.0,
      "corridor_radius_factor": 2.0,
      "pitch_coarse": 0.0001,
      "pitch_fine": 5e-06,
      "corridor_radius_buffer": 0.00002,
      "max_voxels_coarse": 10000000,
      "max_voxels_fine": 10000000,
      "auto_relax_fine_pitch": true,
      "pitch_step_factor": 1.5,
      "clearance": 0.00002,
      "local_radius": 0.00002,
      "inflation_mode": "clearance_plus_local_radius",
      "max_nodes_coarse": 100000,
      "max_nodes_fine": 500000,
      "timeout_s": 60.0,
      "turn_penalty": 0.1,
      "heuristic_weight": 1.0,
      "smoothing_enabled": true,
      "smoothing_iters": 3,
      "smoothing_strength": 0.5,
      "allow_partial": false,
      "diagonal_movement": true,
      "allow_skip_waypoints": true,
      "max_skip_count": 3
    },
    "growth": {
      "enabled": true,
      "backend": "kary_tree",
      "target_terminals": 1024,
      "terminal_tolerance": 0.1,
      "max_iterations": 500,
      "seed": null,
      "min_segment_length": 0.00001,
      "max_segment_length": 0.0002,
      "min_radius": 0.00001,
      "step_size": 0.0001,
      "backend_params": {
        "tree_extent_fraction": 0.95,
        "branch_length_decay": 0.75,
        "angle_deg": 45.0,
        "angle_variation_deg": 5.0,
        "primary_axis": [0, 0, -1],
        "upward_forbidden": true,
        "max_deviation_deg": 60.0,
        "multi_inlet_mode": "forest_with_merge",
        "collision_merge_distance": 0.00005
      }
    },
    "collision": {
      "enabled": true,
      "check_collisions": true,
      "collision_clearance": 0.00002
    },
    "unified_collision": {
      "enabled": true,
      "min_clearance": 0.00002,
      "strategy_order": [
        "reroute",
        "shrink",
        "terminate"
      ],
      "min_radius": 0.00001,
      "check_segment_segment": true,
      "check_segment_mesh": true,
      "check_segment_boundary": true,
      "check_node_boundary": true,
      "reroute_max_attempts": 3,
      "shrink_factor": 0.9,
      "shrink_max_iterations": 5,
      "inflate_by_radius": true,
      "check_after_each_step": true
    },
    "radius": {
      "mode": "murray",
      "murray_exponent": 3.0,
      "taper_factor": 0.8,
      "min_radius": 0.00001,
      "max_radius": 0.005
    },
    "retry": {
      "max_retries": 3,
      "backoff_factor": 1.5,
      "retry_with_larger_clearance": true,
      "clearance_increase_factor": 1.2
    },
    "waypoint": {
      "skip_unreachable": true,
      "max_skip_count": 3,
      "emit_warnings": true,
      "fallback_direct": true
    },
    "ports": {
      "enabled": true,
      "face": "top",
      "pattern": "explicit",
      "pattern_params": {},
      "projection_mode": "clamp_to_face",
      "ridge_width": 0.0001,
      "ridge_clearance": 0.0001,
      "port_margin": 0.00005,
      "disk_constraint_enabled": true,
      "ridge_constraint_enabled": true,
      "placement_fraction": 0.9,
      "angular_offset": 0.0
    },
    "channels": {
      "enabled": false,
      "profile": "cylinder",
      "length_mode": "explicit",
      "length": null,
      "length_fraction": 0.5,
      "start_offset": 0.0,
      "stop_before_boundary": 0.0,
      "taper_factor": 0.5,
      "radius_end": null,
      "bend_mode": "radial_out",
      "hook_depth": 0.002,
      "hook_strength": 0.5,
      "hook_angle_deg": 90.0,
      "straight_fraction": 0.3,
      "curve_fraction": 0.4,
      "bend_shape": "quadratic",
      "segments_per_curve": 16,
      "radial_sections": 16,
      "path_samples": 32,
      "enforce_effective_radius": true,
      "constraint_strategy": "reduce_depth"
    },
    "network_cleanup": {
      "enable_snap": true,
      "snap_tol": 0.00001,
      "enable_prune": true,
      "min_segment_length": 0.00001,
      "enable_merge": true,
      "merge_tol": 0.00001
    },
    "mesh_synthesis": {
      "add_node_spheres": true,
      "cap_ends": true,
      "radius_clamp_min": null,
      "radius_clamp_max": null,
      "voxel_repair_synthesis": false,
      "voxel_repair_pitch": 0.0001,
      "voxel_repair_auto_adjust": true,
      "voxel_repair_max_steps": 4,
      "voxel_repair_step_factor": 1.5,
      "voxel_repair_max_voxels": 100000000,
      "segments_per_circle": 16,
      "mutate_network_in_place": false,
      "radius_clamp_mode": "copy",
      "use_resolution_policy": false
    },
    "mesh_merge": {
      "mode": "auto",
      "voxel_pitch": null,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 4,
      "pitch_step_factor": 1.5,
      "fallback_boolean": true,
      "keep_largest_component": true,
      "min_component_faces": 100,
      "min_component_volume": 1e-12,
      "fill_voxels": true,
      "max_voxels": 100000000,
      "use_resolution_policy": true,
      "min_voxels_per_diameter": 4,
      "min_channel_diameter": 0.00002,
      "detail_loss_threshold": 0.5,
      "detail_loss_strictness": "warn"
    },
    "composition": {
      "repair_enabled": true,
      "union_before_embed": true,
      "repair_fill_holes": true,
      "repair_voxel_pitch": 5e-06,
      "keep_largest_component": true,
      "min_component_volume": 1.0000000000000002e-12,
      "synthesis_policy": {
        "add_node_spheres": true,
        "cap_ends": true,
        "radius_clamp_min": null,
        "radius_clamp_max": null,
        "voxel_repair_synthesis": false,
        "voxel_repair_pitch": 1e-05,
        "voxel_repair_auto_adjust": true,
        "voxel_repair_max_steps": 4,
        "voxel_repair_step_factor": 1.5,
        "voxel_repair_max_voxels": 100000000,
        "segments_per_circle": 16,
        "mutate_network_in_place": false,
        "radius_clamp_mode": "copy",
        "use_resolution_policy": false
      },
      "merge_policy": {
        "mode": "auto",
        "voxel_pitch": null,
        "auto_adjust_pitch": true,
        "max_pitch_steps": 4,
        "pitch_step_factor": 1.5,
        "fallback_boolean": true,
        "keep_largest_component": true,
        "min_component_faces": 100,
        "min_component_volume": 1e-12,
        "fill_voxels": true,
        "max_voxels": 100000000,
        "use_resolution_policy": true,
        "min_voxels_per_diameter": 4,
        "min_channel_diameter": 0.00002,
        "detail_loss_threshold": 0.5,
        "detail_loss_strictness": "warn"
      },
      "repair_policy": {
        "voxel_repair_enabled": true,
        "voxel_pitch": 1e-05,
        "auto_adjust_pitch": true,
        "max_pitch_steps": 4,
        "pitch_step_factor": 1.5,
        "fill_voxels": true,
        "remove_small_components_enabled": true,
        "min_component_faces": 500,
        "min_component_volume": 1e-12,
        "fill_holes_enabled": true,
        "smooth_enabled": false,
        "smooth_iterations": 10
      }
    },
    "embedding": {
      "voxel_pitch": null,
      "shell_thickness": 0.00005,
      "use_resolution_policy": true,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 4,
      "pitch_step_factor": 1.5,
      "max_voxels": 3000000,
      "fallback": "auto",
      "preserve_ports_enabled": true,
      "preserve_mode": "recarve",
      "carve_radius_factor": 1.2,
      "carve_depth": 0.002,
      "output_domain_with_void": true,
      "output_void_mesh": true,
      "output_shell": false
    },
    "validity": {
      "check_watertight": true,
      "check_components": true,
      "check_min_diameter": false,
      "check_open_ports": true,
      "check_bounds": true,
      "check_void_inside_domain": true,
      "min_diameter_threshold": 0.0005,
      "max_components": 1,
      "allow_boundary_intersections_at_ports": true,
      "surface_opening_tolerance": 0.0005
    },
    "open_port": {
      "enabled": true,
      "probe_radius_factor": 1.2,
      "probe_length": 0.002,
      "min_connected_volume_voxels": 10,
      "mode": "voxel_connectivity",
      "validation_pitch": 5e-06,
      "local_region_size": 0.002,
      "max_voxels_roi": 2000000,
      "auto_relax_pitch": true,
      "min_voxels_across_radius": 8,
      "adaptive_pitch": true,
      "prefer_fine_pitch": true,
      "roi_first_reduction": true
    },
    "repair": {
      "voxel_repair_enabled": true,
      "voxel_pitch": 1e-05,
      "auto_adjust_pitch": true,
      "max_pitch_steps": 4,
      "pitch_step_factor": 1.5,
      "fill_voxels": true,
      "remove_small_components_enabled": true,
      "min_component_faces": 200,
      "min_component_volume": 1e-12,
      "fill_holes_enabled": true,
      "smooth_enabled": false,
      "smooth_iterations": 10
    },
    "output": {
      "output_dir": "./out/malaria_venule_bifurcating_tree",
      "output_units": "mm",
      "naming_convention": "default",
      "save_intermediates": true,
      "save_reports": true,
      "output_stl": true,
      "output_json": true,
      "output_shell": true
    }
  },
  "domains": {
    "cylinder_domain": {
      "type": "cylinder",
      "center": [
        0.0,
        0.0,
        0.0
      ],
      "radius": 0.005,
      "height": 0.002
    }
  },
  "components": [
    {
      "id": "bifurcating_tree_1",
      "domain_ref": "cylinder_domain",
      "ports": {
        "inlets": [
          {
            "name": "inlet_center",
            "position": [
              0.0,
              0.0,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0005,
            "vessel_type": "arterial",
            "is_surface_opening": true,
            "_comment": "Direction must point into the domain (inward/down for top-face inlets)"
          },
          {
            "name": "inlet_ring_1",
            "position": [
              0.003,
              0.0,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0004,
            "vessel_type": "arterial",
            "is_surface_opening": true
          },
          {
            "name": "inlet_ring_2",
            "position": [
              0.0,
              0.003,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0004,
            "vessel_type": "arterial",
            "is_surface_opening": true
          },
          {
            "name": "inlet_ring_3",
            "position": [
              -0.003,
              0.0,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0004,
            "vessel_type": "arterial",
            "is_surface_opening": true
          },
          {
            "name": "inlet_ring_4",
            "position": [
              0.0,
              -0.003,
              0.001
            ],
            "direction": [
              0.0,
              0.0,
              -1.0
            ],
            "radius": 0.0004,
            "vessel_type": "arterial",
            "is_surface_opening": true
          }
        ],
        "outlets": []
      },
      "build": {
        "type": "backend_network",
        "backend": "kary_tree",
        "backend_params": {
          "K": 2,
          "num_levels": 12,
          "terminal_radius": 0.00001
        }
      },
      "save_artifacts": {
        "network": "artifacts/bifurcating_tree_network.json",
        "void_mesh": "artifacts/bifurcating_tree_void.stl"
      }
    }
  ],
  "composition": {
    "save_union": "artifacts/union_void.stl"
  },
  "embedding": {
    "enable": true,
    "outputs": {
      "domain_with_void": "domain_with_void.stl",
      "void_mesh": "void_union.stl"
    }
  },
  "validity": {
    "enable": true,
    "save_report": "validity_report.json"
  },
  "outputs": {
    "artifacts_dir": "artifacts",
    "named": {
      "run_report": "run_report.json"
    }
  }
}
